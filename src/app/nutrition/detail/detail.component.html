<app-progress-bar *ngIf="loading"></app-progress-bar>
<app-page-loading *ngIf="loading"></app-page-loading>
<div *ngIf="!loading" class="wrapper bg-white rounded shadow">
  <div
    class="
      d-flex
      align-items-center
      justify-content-between
      app-title
      m-bottom-25
    "
  >
    <h2>
      Nhu cầu dinh dưỡng:
      <span *ngIf="cowBreed$ | async as cowBreed; else elseText">{{
        cowBreed.data.name
      }}</span>
      <ng-template #elseText>...</ng-template>
    </h2>
    <app-button
      [matMenuTriggerFor]="optionsPanel"
      [iconName]="'more_horiz'"
      [customClasses]="['app-button-option']"
    ></app-button>

    <mat-menu #optionsPanel="matMenu" xPosition="before">
      <app-menu-item
        [iconName]="'drive_file_rename_outline'"
        [menuItemContent]="'Cập nhật'"
      ></app-menu-item>
      <mat-divider></mat-divider>
      <app-menu-item
        [iconName]="'delete_outline'"
        [menuItemContent]="'Xoá'"
      ></app-menu-item>
    </mat-menu>
  </div>
  <div class="content">
    <div class="period-list">
      <div class="period-list-item" *ngFor="let period of periods">
        <div
          class="
            d-flex
            justify-content-between
            align-items-center
            period-list-item-header
          "
        >
          <h4>Giai đoạn: {{ period.name }}</h4>
          <app-button-icon
            [matMenuTriggerFor]="nutritionPanel"
            [iconName]="'more_horiz'"
            matTooltip="Tuỳ chọn"
          ></app-button-icon>

          <mat-menu #nutritionPanel="matMenu" xPosition="before">
            <app-menu-item
              [iconName]="'add'"
              [menuItemContent]="'Thêm mới'"
              (click)="createNutrition(period._id)"
            ></app-menu-item>
            <mat-divider></mat-divider>
            <app-menu-item
              [iconName]="'delete_outline'"
              [menuItemContent]="'Xoá tất cả'"
            ></app-menu-item>
          </mat-menu>
        </div>

        <div class="period-list-item-content">
          <div
            style="width: 95%; margin: 0 auto"
            class="table-container p-bottom-25"
          >
            <table mat-table [dataSource]="period.nutrition">
              <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef>STT</th>
                <td mat-cell *matCellDef="let element; let i = index">
                  {{ i + 1 }}
                </td>
              </ng-container>

              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Tên</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.name }}
                </td>
              </ng-container>

              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Hàm lượng</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.amount }}
                </td>
              </ng-container>

              <ng-container matColumnDef="unit">
                <th mat-header-cell *matHeaderCellDef>Đơn vị đo</th>
                <td mat-cell *matCellDef="let element">{{ element.unit }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr
                mat-row
                *matRowDef="let element; columns: displayedColumns"
                style="cursor: pointer"
                class="app-element-row"
                (click)="updateNutrition(period._id, element)"
              ></tr>
              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">Chưa có dữ liệu</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-page-loading *ngIf="loading"></app-page-loading>
<app-progress-bar *ngIf="loading"></app-progress-bar>
<app-back-button [routerLink]="['/giong-bo', cowBreedId]"></app-back-button>
<div *ngIf="!loading" class="wrapper bg-white rounded shadow">
  <div
    fxLayout="row"
    fxLayoutAlign="space-between center"
    class="app-title m-bottom-25"
  >
    <h2>Thông tin giai đoạn</h2>
    <app-button
      [matMenuTriggerFor]="optionsPanel"
      [iconName]="'more_horiz'"
      [customClasses]="['app-button-option']"
    >
    </app-button>

    <mat-menu #optionsPanel="matMenu" xPosition="before">
      <app-menu-item
        [iconName]="'delete_outline'"
        [menuItemContent]="'Xoá'"
        (click)="onDeletePeriod()"
      ></app-menu-item>
    </mat-menu>
  </div>
  <div class="content">
    <div fxLayout="row" fxLayoutAlign="center" class="m-bottom-20">
      <div fxFlex="25">
        <span class="font-weight-bold">Tên giai đoạn</span>
      </div>
      <div fxFlex fxLayout="row" fxLayoutAlign="start">
        <span>{{ period.name }}</span>
      </div>
    </div>
    <div fxLayout="row" class="m-bottom-20">
      <div fxFlex="25">
        <span class="font-weight-bold">Ngày bắt đầu</span>
      </div>
      <div fxFlex>
        <span>{{ period.startDay }}</span>
      </div>
    </div>

    <div fxLayout="row" class="m-bottom-20">
      <div fxFlex="25">
        <span class="font-weight-bold">Ngày kết thúc</span>
      </div>
      <div fxFlex>
        <span>{{ period.endDay }}</span>
      </div>
    </div>

    <div fxLayout="row" class="m-bottom-20">
      <div fxFlex="25">
        <span class="font-weight-bold">Cân nặng</span>
      </div>
      <div fxFlex>
        <span>{{ period.weight }} kg</span>
      </div>
    </div>

    <div class="nutrition m-bottom-20">
      <div
        fxLayout="row"
        fxLayoutAlign="space-between center"
        class="nutrition-header"
      >
        <span class="font-weight-bold">Bảng nhu cầu dinh dưỡng</span>
        <app-button-icon
          [iconName]="'settings'"
          [matMenuTriggerFor]="nutritionOptionPanel"
        >
        </app-button-icon>
        <mat-menu #nutritionOptionPanel="matMenu" xPosition="before">
          <app-menu-item
            [iconName]="'add'"
            [menuItemContent]="'Thêm mới'"
            (click)="createNutrition(period._id)"
          ></app-menu-item>
        </mat-menu>
      </div>

      <div class="nutrition-content">
        <div fxLayout="row" fxLayoutAlign="center center" class="m-bottom-20">
          <table
            mat-table
            [dataSource]="period.nutrition ? period.nutrition : []"
          >
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>STT</th>
              <td mat-cell *matCellDef="let element; let i = index">
                {{ i + 1 }}
              </td>
            </ng-container>

            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Tên</th>
              <td mat-cell *matCellDef="let element">
                {{ element.name }}
              </td>
            </ng-container>

            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Hàm lượng</th>
              <td mat-cell *matCellDef="let element">
                {{ element.amount }}
              </td>
            </ng-container>

            <ng-container matColumnDef="unit">
              <th mat-header-cell *matHeaderCellDef>Đơn vị đo</th>
              <td mat-cell *matCellDef="let element">
                {{ element.unit }}
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef colspan="2"></th>
              <td mat-cell *matCellDef="let element">
                <app-button-icon
                  matTooltip="Chỉnh sửa"
                  (click)="$event.stopPropagation()"
                  [iconName]="'edit'"
                  (click)="updateNutrition(period._id, element)"
                ></app-button-icon>
                <app-button-icon
                  matTooltip="Xoá"
                  (click)="$event.stopPropagation()"
                  [iconName]="'delete'"
                  [customClasses]="['color-red']"
                  (click)="onDeleteNutrition(period._id, element.idNutrition)"
                ></app-button-icon>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="nutritionColumns"></tr>
            <tr
              mat-row
              *matRowDef="let element; columns: nutritionColumns"
              style="cursor: pointer"
              class="app-element-row"
            ></tr>
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="5">Chưa có dữ liệu</td>
            </tr>
          </table>
        </div>
      </div>
    </div>

    <div class="food">
      <div fxLayout="row" fxLayoutAlign="start center" class="food-header">
        <span class="font-weight-bold">Khẩu phần ăn tiêu chuẩn</span>
      </div>

      <div class="food-content">
        <div fxLayout="row" fxLayoutAlign="center center" class="m-bottom-20">
          <table mat-table [dataSource]="period.foods ? period.foods : []">
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>STT</th>
              <td mat-cell *matCellDef="let element; let i = index">
                {{ i + 1 }}
              </td>
            </ng-container>

            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Tên</th>
              <td mat-cell *matCellDef="let element">
                {{ element.name }}
              </td>
            </ng-container>

            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Hàm lượng</th>
              <td mat-cell *matCellDef="let element">
                {{ element.amount }}
              </td>
            </ng-container>

            <ng-container matColumnDef="unit">
              <th mat-header-cell *matHeaderCellDef>Đơn vị đo</th>
              <td mat-cell *matCellDef="let element">
                {{ element.unit }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="foodColumns"></tr>
            <tr
              mat-row
              *matRowDef="let element; columns: foodColumns"
              style="cursor: pointer"
              class="app-element-row"
            ></tr>
            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="4">Chưa có dữ liệu</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
